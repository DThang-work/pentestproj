<?php


function construct()
{
    load_model('index');
    load('helper', 'format');
}
function indexAction()
{
    global $conn;
    if (isset($_POST['action'])) {
        $query = "SELECT * FROM `tbl_post` WHERE 1"; // Always include 1 to start the WHERE clause
    }

    if (isset($_POST['price'])) {
        if ($_POST['price'] == 5) {
            $query .= " AND `price` <= 5000000";
        } else if ($_POST['price'] == 8) {
            $query .= " AND `price` BETWEEN 5000000 AND 1000000";
        } else if ($_POST['price'] == 10) {
            $query .= " AND `price` > 10000000 ";
        }
    }

    // if (isset($_POST['category'])) {
    //     $category_name = $_POST['category'];
    //     $query .= " AND `slug` = '$category_name'";
    // }

    if (isset($_POST['price_prd'])) {
        if ($_POST['price_prd'] == 'asc') {
            $query .= " ORDER BY `price` ASC";
        } else if ($_POST['price_prd'] == 'desc') {
            $query .= " ORDER BY `price` DESC";
        }
    }

    $data = '';
    if (!empty(mysqli_query($conn, $query))) {
        foreach (mysqli_query($conn, $query) as $item) {
            $data = '
                    <li class="border rounded-lg overflow-hidden">
                        <a class="h-[240px] overflow-hidden block" href="chi-tiet-bai-viet-' . $item['id'] . '/' . make_url($item['title']) . '.html" title="" class="thumb">
                            <img class="w-full h-full object-cover" src="uploads/post/' . $item['image'] . '">
                        </a>
                        <a class="p-2 block text-xl font-semibold h-16 line-clamp-1" href="chi-tiet-bai-viet-' . $item['id'] . '/' . make_url($item['title']) . '.html" title="" class="product-name">' . $item['title'] . '</a>
                        <p class="mx-2 line-clamp-4 mt-2 mb-2">Lorem ipsum dolor sit amet consectetur adipisicing elit. Quaerat aliquid vitae similique nesciunt soluta accusamus iste amet ea? Debitis, quisquam?</p>
                        <div class="price p-2 flex justify-center gap-2 bg-slate-50">
                            <span class="new text-red-500 text-xl py-2">' . currency_format($item['price']) . '</span>
                        </div>
                    </li>
            ';
            echo $data;
        }
    } else {
        echo '<h3>Không tìm thấy !</h3>';
    }
}
